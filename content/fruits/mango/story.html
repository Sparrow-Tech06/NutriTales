<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mango â€” NutriTales</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/styles.css">
</head>
<body>
  <main class="container page-frame py-4">
    <nav class="d-flex justify-content-between align-items-center mb-3">
      <a href="../../category.html?cat=fruits" class="text-decoration-none"><i class="bi bi-arrow-left"></i> Back</a>
      <div>
        <select id="langSelect" class="form-select lang-select"></select>
      </div>
    </nav>

    <article class="story-card">
      <div class="story-hero mb-3">
        <img id="heroImg" src="img.jpg" alt="Mango" loading="lazy">
      </div>

      <section class="story-content bg-white rounded shadow-sm">
        <header class="mb-2 px-3 pt-3 d-flex justify-content-between align-items-start">
          <div>
            <h1 id="itemName" class="h4 mb-1">Mango</h1>
            <div id="shortDesc" class="text-muted-small">Sweet tales from the orchard.</div>
          </div>
          <div class="text-end text-muted-small">ðŸ¥­</div>
        </header>

        <div class="px-3 pb-3 story-text fade-in" id="storyText"></div>

        <hr>

        <div class="px-3 pb-3">
          <h5>Benefits</h5>
          <ul id="benefitsList" class="mb-0"></ul>
        </div>
      </section>
    </article>

    <footer class="mt-4 text-center small text-muted">NutriTales â€” Prototype</footer>
  </main>

  <script src="../../assets/js/app.js"></script>
  <script>
    (async function(){
      const data = await loadJSON('data.json');
      if(!data) { document.getElementById('storyText').innerHTML = '<p class="text-danger">Failed to load.</p>'; return }
      const langs = data.meta.availableLangs || Object.keys(data.story);
      const langSelect = document.getElementById('langSelect');
      langs.forEach(code => { const opt = document.createElement('option'); opt.value = code; opt.textContent = code.toUpperCase(); langSelect.appendChild(opt); });
      const defaultLang = (navigator.language||'en').slice(0,2);
      langSelect.value = langs.includes(defaultLang) ? defaultLang : (langs.includes('en') ? 'en' : langs[0]);

      function render(lang){
        document.getElementById('itemName').textContent = data.name[lang] || data.name['en'];
        document.getElementById('storyText').innerHTML = '<p>'+ (data.story[lang] || data.story['en']) +'</p>';
        const bList = document.getElementById('benefitsList'); bList.innerHTML=''; (data.benefits[lang]||[]).forEach(b=>{const li=document.createElement('li');li.textContent=b;bList.appendChild(li)});
      }

      langSelect.addEventListener('change', ()=> render(langSelect.value));
      render(langSelect.value);
      safeImg(document.getElementById('heroImg'));
    })();
  </script>
</body>
</html>
