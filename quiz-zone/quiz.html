<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no,viewport-fit=cover">  
  <title>NutriTales - quiz game</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root{
      --bg: #eafaf1;
      --card: #ffffff;
      --accent: #2ecc71;
      --soft-shadow: 0 10px 18px rgba(11,40,60,0.06);
      --deep-shadow: 0 18px 28px rgba(11,40,60,0.08);
      --radius: 20px;
      font-family: 'Nunito', sans-serif;
    }
    * {
       margin: 0;
       padding: 0;
       box-sizing: border-box;
       user-select: none;
     }
    body{
      margin:0;
      background: linear-gradient(180deg, var(--bg) 0%, #f6fdf9 100%);
      min-height:100vh;
      font-family: 'Nunito', sans-serif;
    }
    .header {
         display: flex;
         align-items: center;
         justify-content: space-between;
         padding: 10px 10px ;
         background-color: var(--accent) ;
         box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         position: sticky ;
         top: 0 ;
      }
   .back-btn {  
      background:rgba(255,255,255,0.3);
      border:0;
      color:#fff;
      font-size:1.2rem;
      width:38px;
      height:38px;
      border-radius:50%;
      display:flex;
      align-items:center;
      justify-content:center;
      transition:.25s;
    }
    .back-btn:hover{ background:rgba(255,255,255,0.3); }

    .quiz-card { 
       max-width: 700px; 
       margin: 40px auto; 
       border-radius: 20px;
       box-shadow: var(--soft-shadow);
     }
     #question {
       padding: 40px 10px;
       background: var(--accent);
       border-radius: 10px;
       box-shadow: var(--soft-shadow);
       color: #fff ;
     }
    .badges {  
      background:var(--bg); 
      display: inline-block;
      border-radius: 10px;
      padding: 5px 10px;
       }
    .coin { color: gold; font-size: 1.2rem; }
    .option-btn {
      transition: 0.3s;
      border-radius: 12px;
    }
    .correct { background: #c8e6c9 !important; }
    .wrong { background: #ffcdd2 !important; }
    .success { background: var(--accent) !important; margin: 40px auto; color:#fff !important; }
    .primary { background: #FF6B6B !important; margin: 40px auto; color: #fff !important; }
    
  </style>
</head>
<body>

  <header class="header">
     <a onclick="return false;" aria-label="Back" class="btn back-btn back-link">
         <i class="bi bi-arrow-left"></i>
      </a>
     <p class="badges">
        <i class="bi bi-coin coin"></i> Coins: <span id="coins">0</span>
     </p>
  </header>

  <div class="container text-center mt-4">

    <div class="card quiz-card p-4">
      <h6 id="progress" class="text-muted mb-2">Question 0 / 0</h6>
      <h4 id="question">Loading Question...</h4>
      <div id="options" class="row row-cols-2 g-3 my-3"></div>
      <button id="nextBtn" class="btn success w-100 d-none">
        Next Question <i class="bi bi-arrow-right"></i>
      </button>
    </div>

    <a href="badges.html" class="btn primary my-3">
      <i class="bi bi-bar-chart-line"></i> View Levels
    </a>

  </div>

  <script>
    let questions = [];
    let currentQ = 0;
    let coins = parseInt(localStorage.getItem("coins") || "0");
    document.getElementById("coins").innerText = coins;

    async function loadQuestions() {
      const res = await fetch("questions.json");
      questions = await res.json();
      loadQuestion();
    }

    function loadQuestion() {
      const q = questions[currentQ];
      document.getElementById("question").innerText = q.q;
      document.getElementById("progress").innerText = `Question ${currentQ+1} / ${questions.length}`;

      const optionsDiv = document.getElementById("options");
      optionsDiv.innerHTML = "";
      q.options.forEach(opt => {
        const col = document.createElement("div");
        col.className = "col";
        const btn = document.createElement("div");
        btn.className = "p-3 border bg-light option-btn shadow-sm";
        btn.innerText = opt;
        btn.onclick = () => checkAnswer(opt, q.answer, btn);
        col.appendChild(btn);
        optionsDiv.appendChild(col);
      });
    }

    function checkAnswer(selected, correct, btn) {
      const allBtns = document.querySelectorAll(".option-btn");
      allBtns.forEach(b => b.style.pointerEvents = "none");

      if (selected === correct) {
        btn.classList.add("correct");
        coins += 10;
      } else {
        btn.classList.add("wrong");
        allBtns.forEach(b => {
          if (b.innerText === correct) b.classList.add("correct");
        });
        // deduct coins only if > 0
        if (coins > 0) {
          coins -= 10;
          if (coins < 0) coins = 0; // safety check
        }
      }

      // update storage and UI
      localStorage.setItem("coins", coins);
      document.getElementById("coins").innerText = coins;

      document.getElementById("nextBtn").classList.remove("d-none");
    }

    document.getElementById("nextBtn").onclick = () => {
      currentQ++;
      if (currentQ < questions.length) {
        loadQuestion();
        document.getElementById("nextBtn").classList.add("d-none");
      } else {
        endGame();
      }
    };

    function endGame(){
      document.getElementById("progress").innerText = "";
      document.getElementById("question").innerText = "ðŸŽ‰ Game Over!";
      document.getElementById("options").innerHTML = `
        <p class='fw-bold text-success'>Well played!</p>
        <button class='btn success w-100 my-2' onclick='playAgain()'> Play Again </button>
        <a onclick="window.history.back()" class='btn primary w-100 my-2'> Back to Home </a>
      `;
      document.getElementById("nextBtn").classList.add("d-none");
    }

    function playAgain(){
      currentQ = 0;
      loadQuestion();
    }

    loadQuestions();
  </script>

<!-- Our back to confirm script -->
<script src="https://sparrow-tech06.github.io/NutriTales/addon/backConfirm.js"></script>
<!-- Website version checker & cache clear -->
<script src="https://sparrow-tech06.github.io/NutriTales/addon/version-check.js"> </script>
  
</body>
</html>
